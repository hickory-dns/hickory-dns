name: publish

on:
  release:
    types:
      - published

jobs:
  publish:
    name: publish
    # wait for the cache from all-features
    #  TODO: we really want this:
    # needs: ./.github/workflows/test/platform-matrix
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - uses: actions-rs/toolchain@v1
      with:
        profile: minimal
        toolchain: stable
        override: true

    - uses: extractions/setup-just@v1

    - name: cargo install cargo-workspaces
      uses: baptiste0928/cargo-install@v2
      with:
        crate: cargo-workspaces

    - name: just publish
      env:
        CRATES_IO_TOKEN: ${{ secrets.CRATES_IO_TOKEN }}
      run: just publish
